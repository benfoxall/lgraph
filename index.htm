<!DOCTYPE html>

<html>
<head>
	<title>last fm canvas graph</title>
	<style type="text/css" media="screen">
body{font-family:Arial,"MS Trebuchet",sans-serif;margin:0;padding:0;}
p.err,noscript{color:#c10000;font-size:1em;display:block;padding:.5em;margin:0;float:right;}
p.err span{display:block;}
form{border-bottom:1px dotted #ccc;padding:.5em;margin:0;}
input{font-size:1em;font-weight:bold;}
input#weeks{width:2em;}
label{color:#666;font-size:.9em;}
#times{font-weight:bold;float:right;}
#display{white-space:nowrap;}
	</style>
	
	<!-- Drop any comments to @benjaminbenben -->
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="_.js" type="text/javascript" charset="utf-8"></script>
	<script src="code.js" type="text/javascript" charset="utf-8"></script>
	
	<script type="text/javascript" charset="utf-8">
		$(function(){
			$('#draw').click(function(e){
				e.preventDefault();
				var user = $('#user').val();
				var weeks = parseInt($('#weeks').val(),10);
				fetch(user,weeks);
				
				// FAO @jonleighton !
				history.pushState({}, "", "?" + $('form').serialize()); 
			});
			
			//check for get params (badly)
			var params = _(location.search).params();
			$('#user').val(params.user || '');
			$('#weeks').val(params.weeks || '10');
			if(params.user && params.weeks){
				$('#draw').click();
			}
		});
	</script>
</head>
<body>
	<noscript>This is Javascript, Yo</noscript>
	<p class="err"></p>
	<p id="times"></p>
	<form>
		<label for="user">Lastfm User</label>
		<input type="text" name="user" id="user" value="" />
		
		<label for="weeks">#Weeks</label>
		<input type="text" name="weeks" id="weeks" value="10" />
		
		<input type="submit" value="draw" id="draw"/>
	</form>
	<div id="display"></div>
</body>
</html>
